- name: Install Curl.
  command: apt-get install -y curl --force-yes

- name: Add Nginx Key.
  command: apt-key add $(curl http://nginx.org/keys/nginx_signing.key) 

- name: Add repository - Debian.
  lineinfile: "dest=/etc/apt/sources.list.d/edgium.{{app}}.list line='deb http://nginx.org/packages/debian/ {{ ansible_distribution_release }} nginx'"
  lineinfile: "dest=/etc/apt/sources.list.d/edgium.{{app}}.list line='deb-src http://nginx.org/packages/debian/ {{ ansible_distribution_release }} nginx'"
  when: ansible_distribution == 'Debian'

- name: Add repository - Ubuntu.
  lineinfile: "dest=/etc/apt/sources.list.d/edgium.{{app}}.list line='deb http://nginx.org/packages/ubuntu/ {{ ansible_distribution_release }} nginx'"
  lineinfile: "dest=/etc/apt/sources.list.d/edgium.{{app}}.list line='deb-src http://nginx.org/packages/ubuntu/ {{ ansible_distribution_release }} nginx'"
  when: ansible_distribution == 'Ubuntu'

- name: Update.
  command: apt-get update

- name: Install Nginx.
  command: apt-get install -y nginx --force-yes

- name: Start Nginx.
  sudo: true 
  command: service nginx start

- shell: nginx -v
  register: version

- debug: msg="{{version.stdout}}"